# 使用pandas进行数据分析

本章将向你介绍pandas，Python数据分析库，或者————我喜欢这样说————基于Python的具有超级功能的电子表格。                                        
它是如此强大，以至于我合作过的一些公司，成功使用Jupyter笔记本和pandas取代了excel。    
然而，作为本书的读者，我假设你会保留Excel，在这种情况下，panda会作为一个从电子表格中读取和写入数据  
的接口。pandas使在Excel中特别痛苦的任务，更容易、更快、和更少错误。其中一些任务包括从外部来源获取
大数据集、处理统计数据、时序数据和交互式图表。pandas的超级能力是矢量化和数据对齐。正如我们在前面
的章节已经看到的，矢量化允许你编写简洁的、基于NumPy阵列的代码。而数据对齐可以确保在处理多个结果集  
时，不会有数据不匹配。

本章涵盖了整个数据分析过程：它从数据清理和准备过程开始，然后向你展示如何通过聚合、描述性统计、
可视化从更大的数据集中获取意义。在本章的最后，我们将看到如何使用pandas导入和导出数据。但首先，
让我们先来介绍pandas的主要数据结构：数据帧DataFrame和序列Series。  

## 数据帧DataFrame和序列Series

数据帧DataFrame和序列Series是pandas中的核心数据结构。在本节，我会介绍数据帧DataFrame的主要组件：
索引index、列columns和数据data。数据帧DataFrame很像一个二维的NumPy阵列array，但他带有行标签和
列标签，并且每列可以容纳不同的数据类型。通过从数据帧DataFrame中提取单个行或列，你可以得到一个
一维的序列Series。同样的，一个序列类似一个带有标签的NumPy阵列。当你查看图5-1中数据帧的结构时，
不需要很多想象力，就可以看出数据帧DataFrame将成为你的基于Python的电子表格。


图5-1

序列Series是一个带有轴标签的一维阵列。轴Axis编号为0。
数据帧DataFrame是一个带有行列标签的二维阵列，而且它的每一列可以是不同的数据类型。


为了显示从电子表格转换到数据帧DataFrame，是多么容易，思考下面的Excel表格在图5-2，
它显示了在线课程的参与者。你将在配套仓库中找到相应的文件。

为了使Excel表格在Python中可用，先要导入pandas，然后使用它的read_excel函数，它会返回一个
数据帧DataFrame。

In [1]: import pandas as pd
In [2]: pd.read_excel("课程参与者名单.xlsx")

Out[2]:		用户id	姓名	年龄	国家	分数	大陆
	0	1001	马克	55	意大利	4.5	欧洲
	1	1000	约翰	33	美国	6.7	美洲
	2	1002	提姆	41	美国	3.9	美洲
	3	1003	珍妮	12	德国	9.0	欧洲

如果你在Jupyter笔记本中运行这个代码，数据帧DataFrame将被很好地格式化为html表格，
这使它看上去更像电子表格。我将花费第7章的整个篇幅介绍如何用pandas读写Excel文件。
因此这里只是介绍性的例子，向你展示电子表格和数据帧是什么，实际上，它们十分相似。

现在，让我们从头开始重新创建数据帧，而不必从Excel文件中读取它：创建数据帧的一种
方法是，以嵌套列表的方式提供数据，以及索引值和列标签。

In [3]: data = [["马克", 55, "意大利", 4.5, "欧洲"],
		["约翰", 33, "美国", 6.7, "美洲"],
		["提姆", 41, "美国", 3.9, "美洲"],
		["珍妮", 12, "德国", 9.0, "欧洲"]]

	df = pd.DataFrame(data=data,
			  columns=["姓名", "年龄", "国家", "分数", "大陆"],
			  index=[1001, 1000, 1002, 1003])
	df

通过调用info方法，你将会获得一些基础的信息，最重要的是数据点的个数和每一列的
数据类型：
In [4]: df.info()

如果你只对列的数据类型感兴趣，运行df.dtypes()替代。
具有字符串或混合数据类型的列，将具备对象Object数据类型。
让我们现在来更仔细地看看数据帧的索引和列。

### 索引

数据帧的行标签称为索引。如果你不想有一个有意义的索引，那么在构造pandas时，
不要提供它，pandas会自动创建一个从零开始的，整型索引。我们在从Excel文件
读取数据帧DataFrame的第一个示例中看到这一点。索引将使pandas能够更快地索引
数据，并且对很多常用操作（如：合并两个数据帧）至关重要。你可以按如下方法访问
索引对象77：

In [5]: df.index
Out[5]: Int64Index([1001, 1000, 1002, 1003], dtype='int64')

如果索引是有意义的，给索引一个名称，让我们按照excel表格，将其命名为用户ID。

In [6]: df.i 2333333333313333ndex.name = "user_id"
	df

Out[6]: 	姓名	年龄	国家	分数	大陆
	用户ID
	1001	马克	55	意大利	4.5	欧洲
	1000	约翰	33	美国	6.7	美洲
	1002	提姆	41	美国	3.9	美洲
	1003	珍妮	12	德国	9.0 	欧洲

不像数据库的主键，一个数据帧DataFrame的索引可以有重复，但在这种情况下，查找值可能比较慢。
要将一个索引转换成一个常规的列，可以用reset_index()函数；要设置新索引，用set_index()函数。
如果你不想在设置新索引时丢失现有索引，请确保现先将其重置：

In [7]: # "reset_index" 转换一个索引为一列，重置索引为缺省索引。这对应于一开始我们从Excel加载的数据帧。
	df.reset_index()

In [8]: # "set_index" 转换 “姓名”列为索引。
	df.reset_index().set_index("姓名")

Out[8]: 	用户ID	年龄	国家	分数	大陆

	姓名
	马克	1001	55	意大利	4.5	欧洲
	约翰	1000	33	美国	6.7	美洲
	提姆	1002	41	美国	3.9	美洲
	珍妮	1003	12	德国	9.0	欧洲

通过执行df.reset_index().set_index("姓名")，你使用的是方法链接：
由于reset_index()返回一个数据帧，你可以直接调用

