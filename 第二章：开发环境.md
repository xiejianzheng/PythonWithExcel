# 第二章：开发环境

你可能已经迫不及待地想学习Python的基础知识，但在开始之前，你首先需设置好你的
电脑。要编写VBA代码或Power查询，只需要启动Excel，分别打开VBA或PowerQuery编辑器
即可。使用Python，需要一点更多的工作。

我们将从安装Anaconda Python发行版来开始这一章。
除了安装Python，Anaconda还将给我们提供Anaconda Prompt（Anaconda 敏捷促进器）
和Jupyter笔记本，这两个是我会在本书中使用的基本工具。
Anaconda Prompt是一个特殊的命令提示符（Windows）或终端（macOS）。
它允许我们允许使用Python脚本和其他在这本书将会遇到的命令行工具。
Jupyter笔记本允许我们以交互的方式处理数据、代码和图表，这使它成为Excel工作本
有利的竞争者。在使用Jupyter笔记本之后，我们会安装Visual Studio Code (VS Code),
一个强大的文本编辑器。VS Code 非常合适编写、运行和调试Python代码，
并附带集成终端。

图2-1总结了Anaconda和VS Code包含的内容。因为这本书是关于Excel的，所以本章我会
重点介绍Window和macOS。然而，第三部分之前的所有东西都能在Linux上运行。
让我们开始安装Anaconda吧。

## Anaconda Python 发行版

### 包管理器：Conda和pip
在前一章，我已经讲了一些关于Python包管理器pip的内容：pip负责下载、安装、更新和
卸载Python包以及它们的依赖和子依赖项。虽然Anaconda和pip一起工作，但它有一个内
置的替代的包管理器叫Conda。Conda的一个优点是它能安装不只是Python包还包括附加
其他版本的Python解析器。简单回顾一下：包会在你的Python安装中添加没有被标准库
覆盖的其他功能。如我将在第五章讲到的pandas就是这样一个包的例子。由于pandas已经
预安装在了Anaconda的Python安装中。你不需要手动安装它。

**CONDA vs PIP**
使用Anaconda，你应该通过Conda安装所有能通过Conda找到的东西，只有在Conda找不到
的情况下，才用pip安装那些conda找不到的包。Conda可能会覆盖前面用pip安装的文件。

### Conda 环境
你可能困惑为什么Anaconda Prompt（提示符）前面会显示一个（base）在每个输入行
开头。它是活动的Conda环境。一个Conda环境是一个独立的Python世界，其中包含了一个
特定版本的Python和一组已经安装了的，特定版本的包。为什么这是需要的？ 当你开始
并行处理不同项目，他们有不同的要求：一个项目可能需要使用Python 3.8和pandas 0.25
，而另一个项目可能使用Python 3.9和pandas 1.0.0。基于pandas 0.25.0写的代码通常
需要改动才能在pandas 1.0.0上运行，因此你不能只更新你的Python版本和pandas版本
而不修改你的代码。为每一个项目使用一个Conda环境，可以保证每一个项目都以正确
的依赖运行。虽然Conda环境是特定于Anaconda发行版的，但这概念在每一个Python安装
中都存在叫虚拟环境。Conda环境更强大，因为他们使处理不同的Python版本本身变得容
易，而不仅仅是包。当你阅读本书的时候，你不会需要改变你的Conda环境，因为我们总
是使用缺省的base环境。然而，如果你开始构建真实的项目，最好使用一个Conda或虚拟
环境以避免他们依赖之间的互相冲突。关于处理多个Conda环境需要的所有信息都在附录
A中。在那里，你还可以找到构建一个我写这本书时使用的确切包版本的Conda环境的指引。
这会允许你允许本书的例子，即使是很多年以后。另一个选择是看本书的主页，了解对
新的Python和库版本可能需要的改变。

解决完Conda环境的谜团后，是时候介绍下一个工具了，我们将在本书大量使用它：
Jupyter笔记本。

### Jupyter笔记本
在上一节中，我向你们展示了如何在一个Anaconda提示符下开启一个交互式的Python会话。
这是有用的，如果你想用一个简略的环境来测试一些简单的东西。然而，对于你主要的工作，
你希望有一个简易使用的环境。例如回到前面的命令、展示图表，这对于在Anaconda命令行
下运行的Python REPL（read、evaluate、print、loop）来说很难实现。

幸运的是，Anaconda携带的不仅是Python解析器：它还包含了Jupyter笔记本————它已经作为
了科学计算领域中最流行的允许Python代码的方式出现。

Jupyter笔记本允许你讲述一个故事，通过整合Python代码、格式化文本、图片和图表，到一
个交互笔记本中，在你的浏览器中运行。

他们对初学者很友好，因此在开启你的Python旅程的第一步时特别有用。
他们然而，也是非常流行在教学、原型制作和研究方面。因为他们促进了可重复性研究。

Jupyter笔记本已经成为Excel的一个严肃的竞争对手，因为它覆盖了与工作簿几乎相同的案例：
你可以快速准备、分析和可视化数据。

与Excel的区别是，这些都是通过编写Python代码实现的，而不是在Excel中使用鼠标点击。
Jupyter笔记本的另一个优势是，不会混淆数据和业务逻辑：Jupyter笔记本持有你的代码、
和图表，而你通常消费数据从一个外部的CSV文件或数据库。

使Python代码在你的笔记本中可视，使得这很容易看到什么在进行，对比Excel，公式被
隐藏在单元格值之后。Jupyter笔记本还很容易运行在本地或远程服务器。服务器通常有
比你本机更强的能力并且能在完全无人参与的情况下运行你的代码，这是一些Excel很难
做到的事情。

在这一章节，我会向你展示如何运行和导航一个Jupyter笔记本的基础知识。我们会学习
笔记本单元和看看编辑和命令模式有什么区别。我们将会明白为什么单元的运行顺序是重要的，
在我们结束这节之前，通过学习如何正确地关闭笔记本。让我们开始使用我们的第一个笔记本。

### 运行Jupyter笔记本

在Anaconda提示符，改变目录到你的伴随仓库目录，然后启动以Jupyter笔记本服务器：

> cd ./PythonWithExcel
> jupyter notebook

这会自动打开你的浏览器并显示Jupyter仪表板，其中包含你运行命令时所在目录的文件。
在Jupyter仪表板的右上角，点击New按键，然后从下拉菜单中选择Python 3（看 图2-2）。

这将为你的第一个Jupyter笔记本打开一个新的浏览器页签，如图2-3所示。

这是一个好习惯，点击Jupiter徽章旁边的Untitled1文本去重命名你的工作簿为更有意义
的内容——如：第一个笔记本。图2-3的下半部分，显示了一个工作簿单元。移动到下一节，
去学习更多关于他们。

### 笔记本单元
在图2-3中，你可以看到空白的单元格，带着闪烁的光标。如果光标不闪烁了，点击进入
单元使用鼠标，即 "In []"的右边。现在重复最后一节的练习：键入 3 + 4 并且运行单
元格通过点击在顶部菜单栏中的Run按钮，或者更简单————直接输入Shift+Enter。这会
运行单元格中的代码，并转跳到下一个单元格。在这个案例中，它插入了一个空的单元格
在下面，因为我们目前只有一个单元格而已。
更详细地说：当一个单元格在计算，它显示 In[ * ] 并且，当它完成，asterisk星号转换
成一个数字，例如:In[1]。
在单元格下方，你会得到对应的带有相同编号的输出：Out[1]。每次你运行一个单元格，
计数器会增加1，计数器会帮助你看到单元格是以何种顺序执行的。接下来，我将以这种
格式展示代码，例如：前面的REPL（repeat evalute print loop）示例，看上去像这样：

> In [1]: 3 + 4
> Out[1]: 7

这个符号允许你很容易跟随，通过在笔记本格中输入3+4。
当按Shift+Enter运行它，你会得到我在Out[1]下面显示的输出。
如果以一种支持颜色的电子格式读本书，你会注意到，输入单元格使用不同颜色对
字符串、数字等进行格式设置，以便于阅读。这个称为语法高亮。

**CELL OUTPUT**
如果单元格的最后一行返回一个值，Jupyter会自动在Out[ ]下打印这个值。
然而，当你使用print函数或出现异常，它将直接在In单元格下面打印，而不带Out[]
标签。本书的代码示例反映了这种行为。

单元格有不同种类型，其中两种是我们感兴趣的：

Code
  这是默认的类型。只要你想运行Python代码，就使用它。

Markdown
  Markdown是一种使用标准文本符号进行格式化的语法，可用于在你笔记本中包含格式
  良好的解释和说明。

要将单元格的类型改为Markdown，请选择Markdown在“单元格模式”下拉菜单中（
看图2-3）。我将会在表2-3中，展示一个用于改变单元格类型的快捷方式。在改变空白
单元格格式为Markdown后，键入以下文本，其中解释了一些标记规则：

> # 这是一级标题
> ## 这是二级标题
> 你可以设置你的文本为*斜体*，或**粗体**，或`等宽`。
> * 这是一个要点
> * 这是另一个要点
在按下Shift+Enter键后，文本渲染为格式良好的HTML。
此时，你的笔记本应该像2-4图看上去差不多。Markdonw还能允许你包含图片、视频或
公式。
现在你了解了代码和Markdown单元格类型。是时候学习在单元格之间导航的更简单的方式：
下一节介绍编辑和命令模式以及一些键盘快捷方式。

### 编辑以及命令模式

当你与Jupyter笔记本中的单元格交互时，你要么处于编辑模式，要么处于命令模式。

* 编辑模式
  点击进入一个单元格会启动编辑模式：选中的单元格，边框会变绿，并且单元格中的
  光标会闪烁。除了单击进入一个单元格，你还可以在选中一个单元格后按回车进入。

* 命令模式
  要切换到命令模式，按Escape逃逸键。选中的单元格边框会变成蓝色，并且不会有任何
  闪烁的光标。在命令模式下最重要的键盘快捷键如表2-3显示：

表 2-3。键盘快捷键（命令模式）

快捷键		动作

Shift+Enter	运行单元格（在编辑模式下也能用）
上方向按键	向上移动单元格选择器
下方向按键	向下移动单元格选择器
b（below）	在当前单元格下面插入一个新的单元格
a（above）	在当前单元格上面插入一个新的单元格
dd（delete）	删除当前单元格
m（markdown）	修改单元格格式为markdown
y		修改单元格格式为code



* 
